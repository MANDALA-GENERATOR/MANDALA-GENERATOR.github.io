<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mandala Generator</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f4f4f4;
      font-family: Arial, sans-serif;
      gap: 40px;
    }
    .canvas-container {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    canvas {
      border-radius: 50%;
      cursor: crosshair;
    }
    svg {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      width: 100%;
      height: 100%;
    }
    #controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background-color: #333;
      color: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 300px;
      min-width: 200px;
    }
    #controls label {
      margin-bottom: 5px;
    }
    #controls input[type="color"],
    #controls input[type="range"] {
      width: 100%;
    }
    button {
      padding: 10px;
      border: none;
      border-radius: 5px;
      background-color: #555;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #777;
    }
  #footer {
  margin-top: 20px;
  font-family: Arial, sans-serif;
  font-size: 14px;
  color: #333;
  text-align: center;
  position: fixed; /* מיקום קבוע בתחתית */
  bottom: 0; /* יעמוד בתחתית */
  left: 0;
  width: 100%; /* יתפוס את כל רוחב המסך */
  background-color: #f4f4f4; /* צבע רקע לדף */
  padding: 10px 0; /* רווחים סביב הטקסט */
  box-sizing: border-box; /* יכלול את הרווחים בתוך הגודל הכללי */
  }
  </style>
</head>
<body>
  <div class="canvas-container">
    <canvas id="mandalaCanvas" width="600" height="600"></canvas>
    <svg id="overlay"></svg>
  </div>
  <div id="controls" dir="rtl">
    <label>רוחב קנבס:
      <input type="number" id="canvasWidth" value="600" min="100">
    </label>
    <label>גובה קנבס:
      <input type="number" id="canvasHeight" value="600" min="100">
    </label>
    <button id="resizeCanvas">שנה גודל</button>
    <label>צבע קו:
      <input type="color" id="colorPicker" value="#000000">
    </label>
    <label>צבע רקע:
      <input type="color" id="bgColorPicker" value="#ffffff">
    </label>
    <label>חלקים:
      <input type="range" id="sectors" min="4" max="32" value="16">
    </label>
    <label>עובי הקו:
      <input type="range" id="lineWidth" min="1" max="10" value="2">
    </label>
    <label>
      <input type="checkbox" id="mirror" checked> סימטריה
      <input type="checkbox" id="transparency" checked> רקע שקוף
    </label>
    <button id="clearCanvas">ניקוי</button>
    <button id="undoAction">ביטול פעולה אחרונה</button>
    <button id="redoAction">ביצוע מחדש</button> <!-- כפתור Redo -->
    <button id="saveImage">שמור</button>
  </div>
  <div id="footer">
    <p>1. יוצר המנדלות עובד בצורה אופטימלית במחשב.</p>
    <p>2. לשימוש בטלפון, יש להפעיל את מצב המחשב בדפדפן.</p>
    <p>3. שינויים בגודל הקנבס יגרמו למחיקת כל הציורים שבוצעו.</p>
    <p>© כל הזכויות שמורות - יוצר מנדלות</p>
  </div>
  <script>
    // בחירת אלמנטים מהתפריט
    const canvas = document.getElementById("mandalaCanvas");
    const ctx = canvas.getContext("2d");
    const colorPicker = document.getElementById("colorPicker");
    const bgColorPicker = document.getElementById("bgColorPicker");
    const sectorsInput = document.getElementById("sectors");
    const lineWidthInput = document.getElementById("lineWidth");
    const mirrorCheckbox = document.getElementById("mirror");
    const clearCanvasButton = document.getElementById("clearCanvas");
    const undoActionButton = document.getElementById("undoAction");
    const redoActionButton = document.getElementById("redoAction"); // כפתור Redo
    const saveImageButton = document.getElementById("saveImage");
    const overlay = document.getElementById("overlay");
    const transparencyCheckBox = document.getElementById("transparency");
    const canvasWidthInput = document.getElementById("canvasWidth");
    const canvasHeightInput = document.getElementById("canvasHeight");
    const resizeCanvasButton = document.getElementById("resizeCanvas");

    // משתנים גלובליים
    let centerX = canvas.width / 2;
    let centerY = canvas.height / 2;
    let isDrawing = false;
    let previousX, previousY;
    let undoStack = [];
    let redoStack = []; // הוספת מחסנית ל-Redo

    // שמירה של מצב הקנבס לפני כל פעולה
    function saveState() {
      undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
      redoStack = []; // אם נעשתה פעולה חדשה, נמחק את מחסנית ה-Redo
    }

    // ביטול פעולה אחרונה
    function undoLastAction() {
      if (undoStack.length > 0) {
        const lastState = undoStack.pop();
        redoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height)); // נשמור את המצב הנוכחי ב-Redo
        ctx.putImageData(lastState, 0, 0);
      }
    }

    // פעולה של Redo
    function redoLastAction() {
      if (redoStack.length > 0) {
        const nextState = redoStack.pop();
        undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height)); // נשמור את המצב הנוכחי ב-Undo
        ctx.putImageData(nextState, 0, 0);
      }
    }

    // ציור קווים במנדלה
    function drawLine(x1, y1, x2, y2, color, lineWidth, sectors, mirror) {
      ctx.save();
      ctx.translate(centerX, centerY);
      const angleStep = (2 * Math.PI) / sectors;

      for (let i = 0; i < sectors; i++) {
        ctx.strokeStyle = color;
        ctx.lineWidth = lineWidth;
        ctx.lineJoin = "round";
        ctx.lineCap = "round";

        ctx.beginPath();
        ctx.moveTo(x1 - centerX, y1 - centerY);
        ctx.lineTo(x2 - centerX, y2 - centerY);
        ctx.stroke();

        if (mirror) {
          ctx.beginPath();
          ctx.moveTo(-(x1 - centerX), y1 - centerY);
          ctx.lineTo(-(x2 - centerX), y2 - centerY);
          ctx.stroke();
        }

        ctx.rotate(angleStep);
      }
      ctx.restore();
    }

    // התחלת ציור
    function startDrawing(e) {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      previousX = e.clientX - rect.left;
      previousY = e.clientY - rect.top;
      saveState(); // שמור מצב לפני התחלת ציור
    }

    // ציור בפועל
    function draw(e) {
      if (!isDrawing) return;

      const rect = canvas.getBoundingClientRect();
      const currentX = e.clientX - rect.left;
      const currentY = e.clientY - rect.top;

      const color = colorPicker.value;
      const lineWidth = lineWidthInput.value;
      const sectors = sectorsInput.value;
      const mirror = mirrorCheckbox.checked;

      drawLine(previousX, previousY, currentX, currentY, color, lineWidth, sectors, mirror);

      previousX = currentX;
      previousY = currentY;
    }

    // סיום ציור
    function endDrawing() {
      isDrawing = false;
    }

    // התחלת ציור מגע
    canvas.addEventListener("mousedown", startDrawing);
    canvas.addEventListener("mousemove", draw);
    canvas.addEventListener("mouseup", endDrawing);
    canvas.addEventListener("mouseout", endDrawing);

    // פעולה למחיקת הקנבס
    clearCanvasButton.addEventListener("click", () => {
      saveState(); // שמירה של המצב לפני המחיקה
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    // שינוי גודל הקנבס
    resizeCanvasButton.addEventListener("click", () => {
      const newWidth = canvasWidthInput.value;
      const newHeight = canvasHeightInput.value;
      canvas.width = newWidth;
      canvas.height = newHeight;
      centerX = canvas.width / 2;
      centerY = canvas.height / 2;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    // שמירה של התמונה
    saveImageButton.addEventListener("click", () => {
      const imageUrl = canvas.toDataURL("image/png");
      const link = document.createElement("a");
      link.href = imageUrl;
      link.download = "mandala.png";
      link.click();
    });

    // ביטול פעולה אחרונה
    undoActionButton.addEventListener("click", undoLastAction);

    // ביצוע מחדש של פעולה
    redoActionButton.addEventListener("click", redoLastAction);

    // שינוי צבע הרקע
    bgColorPicker.addEventListener("input", () => {
      const bgColor = bgColorPicker.value;
      canvas.style.backgroundColor = bgColor;
    });

    // שקיפות של הרקע
    transparencyCheckBox.addEventListener("change", () => {
      const isTransparent = transparencyCheckBox.checked;
      if (isTransparent) {
        canvas.style.backgroundColor = "transparent";
      } else {
        canvas.style.backgroundColor = bgColorPicker.value;
      }
    });

    // הפעלת ציור מנדלה ברגע שהעמוד נטען
    window.onload = () => {
      ctx.fillStyle = bgColorPicker.value;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    };

  </script>
</body>
</html>
